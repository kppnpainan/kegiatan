<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ubah Data</title>
<style>
body{font-family:Arial;margin:30px}
form{max-width:500px;margin:auto}
label{font-weight:bold}
input,select{width:100%;padding:6px;margin-bottom:10px}
button{padding:8px 14px}
</style>
</head>

<body>
<h2 align="center">Ubah Data Pejabat</h2>

<form onsubmit="update();return false;">
<input type="hidden" id="row">

<label>Jabatan Perbendaharaan</label>
<select id="jabatan">
  <option>KPA</option>
  <option>PPK</option>
  <option>PPSPM</option>
  <option>BPG</option>
   <option>BP</option>
</select>

<label>Kode Satker</label>
<select id="kode_satker"></select>

<label>Nama</label>
<input id="nama" required>

<label>NIP</label>
<input id="nip">

<label>Jenis Jabatan</label>
<select id="jenis">
  <option>Struktural</option>
  <option>Fungsional</option>
  <option>Pelaksana</option>
</select>

<label>No SK</label>
<input id="no_sk">

<label>Tanggal SK</label>
<input type="date" id="tgl_sk">

<label>No Sertifikat</label>
<input id="no_sertifikat">

<label>Tanggal Sertifikat</label>
<input type="date" id="tgl_sertifikat">

<label>No HP</label>
<input id="no_hp">

<button type="submit">ðŸ’¾ Update</button>
<button type="button" onclick="kembali()">â†© Kembali</button>
</form>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwJp0ElQxY0chYj8FpksBCtNq-ZjYwVLdZxR8jsE9H1wtNCUwcszFr2JOJmWlmxC7aiHA/exec";
const rowId = new URLSearchParams(location.search).get("row");
row.value = rowId;

/* LOAD SATKER â†’ LALU DATA */
fetch(API_URL+"?action=satker")
.then(r=>r.json())
.then(s=>{
  let o="";
  s.forEach(x=>o+=`<option value="${x.kode}">${x.kode} - ${x.nama}</option>`);
  kode_satker.innerHTML=o;

  fetch(API_URL+`?action=get&row=${rowId}`)
  .then(r=>r.json())
  .then(d=>{
    jabatan.value = d.jabatan;
    kode_satker.value = d.kode_satker;
    nama.value = d.nama;
    nip.value = d.nip;
    jenis.value = d.jenis;
    no_sk.value = d.no_sk;
    tgl_sk.value = d.tgl_sk?.substring(0,10) || "";
    no_sertifikat.value = d.no_sertifikat;
    tgl_sertifikat.value = d.tgl_sertifikat?.substring(0,10) || "";
    no_hp.value = d.no_hp;
  });
});

function update(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"update",
      row: row.value,
      jabatan: jabatan.value,
      kode_satker: kode_satker.value,
      nama: nama.value,
      nip: nip.value,
      no_sk: no_sk.value,
      tgl_sk: tgl_sk.value,
      no_sertifikat: no_sertifikat.value,
      tgl_sertifikat: tgl_sertifikat.value,
      no_hp: no_hp.value,
      jenis: jenis.value
    })
  }).then(()=>{
    alert("Data berhasil diperbarui");
    kembali();
  });
}

function kembali(){
  location.href="index.html";
}
</script>
</body>
</html>
